<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>pObywatel – Kod QR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="assets/main.css">
    <link rel="icon" href="images/otM5jOA.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <style>
	/* === GŁÓWNE USTAWIENIA === */
	html, body {
		width: 100%;
		max-width: 100vw;
		overflow-x: hidden;
		margin: 0;
		padding: 0;
		font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
		background-color: #f6f8ff;
		color: #1a1a1a;
		box-sizing: border-box;
		display: flex;
		flex-direction: column;
		align-items: center;
	}

	/* === DOLNY PASEK === */
	body .bottom_bar {
		z-index: 0;
		width: 100%;
		max-width: 100vw;
		position: fixed;
		bottom: 0;
		left: 0;
		background: #fff;
		border-top: 1px solid #d8d8d8;
		display: flex;
		justify-content: space-around;
		padding: 8px 0;
	}

	/* === KONTAINER === */
	.container {
		width: 92%;
		max-width: 480px;
		margin: 0 auto;
		padding: 20px 0 90px;
		height: max-content;
		box-sizing: border-box;
		text-align: center;
	}

	/* === NAGŁÓWKI === */
	.main_title {
		font-size: 22px;
		font-weight: 700;
		margin-top: 30px;
		margin-bottom: 6px;
		text-align: center;
	}

	.description {
		font-weight: 400;
		color: #555;
		margin: 0 0 25px 0;
		text-align: center;
	}

	/* === UKŁAD PRZYCISKÓW === */
	.action_grid {
		display: flex;
		flex-direction: column;
		gap: 10px;
		margin-top: 20px;
		width: 100%;
		height: auto;
		align-items: center;
	}

	/* === POJEDYNCZY PRZYCISK === */
	.action {
		background-color: #fff;
		border-radius: 14px;
		width: 95%;
		max-width: 440px;
		min-height: 76px;
		display: grid;
		grid-template-columns: 16% 70% 14%;
		align-items: center;
		box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
		transition: background 0.15s ease;
		cursor: pointer;
	}

	.action:hover {
		background-color: #f1f4ff;
	}

	/* === IKONA PO LEWEJ === */
	.action_image {
		width: 30px;
		height: 30px;
		margin-left: 10px;
		object-fit: contain;
	}

	/* === TEKST W ŚRODKU === */
	.action_text {
		display: flex;
		flex-direction: column;
		justify-content: center;
		gap: 2px;
		margin-left: 6px;
	}

	.action_title {
		font-weight: 600;
		font-size: 16px;
		margin: 0;
		color: #1a1a1a;
	}

	.action_subtitle {
		font-weight: 400;
		font-size: 13px;
		margin: 0;
		color: #777;
	}

	/* === STRZAŁKA === */
	.arrow {
		width: 16px;
		margin-right: 10px;
		opacity: 0.5;
		justify-self: end;
	}

	/* === OKNO BŁĘDU === */
	.error {
		position: fixed;
		inset: 0;
		width: 100%;
		height: 100%;
		z-index: 10;
		display: none;
		justify-content: center;
		align-items: center;
		text-align: center;
	}

	.error_box {
		width: 85%;
		max-width: 340px;
		min-height: 200px;
		border-radius: 15px;
		background-color: #fff;
		box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
		padding: 20px;
		transition: 400ms;
	}

	/* === TEKST BŁĘDU === */
	.error_title {
		opacity: 0.9;
		font-size: 20px;
		margin: 20px 0 8px;
		font-weight: 700;
	}

	.error_description {
		font-size: 14px;
		width: 85%;
		margin: 0 auto;
		color: #444;
	}

	/* === PRZYCISK W BŁĘDZIE === */
	.error_button {
		background-color: var(--text, #0057ff);
		width: 80%;
		max-width: 240px;
		margin: 20px auto 0;
		line-height: 46px;
		height: 46px;
		border-radius: 25px;
		text-align: center;
		color: white;
		font-size: 16px;
		font-weight: 600;
		cursor: pointer;
		transition: opacity 0.2s;
	}

	.error_button:hover {
		opacity: 0.9;
	}

	/* === OPACITY TŁA === */
	.opacity {
		background-color: rgba(0, 0, 0, 0);
		width: 100%;
		height: 100%;
		position: absolute;
		inset: 0;
		transition: background-color 0.2s ease;
	}

	/* === AKTYWNE OKNO BŁĘDU === */
	.error_open {
		display: flex;
	}

	.error_open .opacity {
		background-color: rgba(0, 0, 0, 0.6);
	}

	/* === RESPONSYWNOŚĆ === */
	@media (max-width: 480px) {
		.container {
			width: 94%;
			padding: 15px 0 70px;
		}

		.main_title {
			font-size: 20px;
			margin-top: 25px;
		}

		.description {
			font-size: 14px;
		}

		.action {
			min-height: 70px;
			width: 100%;
			max-width: 400px;
			grid-template-columns: 18% 68% 14%;
		}

		.action_image {
			width: 28px;
			margin-left: 8px;
		}

		.action_title {
			font-size: 15px;
		}

		.action_subtitle {
			font-size: 12.5px;
		}

		.error_box {
			width: 90%;
			max-width: 300px;
			padding: 15px;
		}

		.error_title {
			font-size: 18px;
		}

		.error_description {
			font-size: 13px;
		}
	}
</style>
</head>

<body>
    <body style="overflow-x: hidden; max-width: 100vw;">
    <body style="max-width: 100vw; overflow-x: hidden; margin: 0; padding: 0;">
    <div class="container" style="max-width: 100%; overflow-x: hidden;">
        <p class="main_title">Kod QR</p>
        <p class="description">Wybierz, co chcesz zrobić</p>

        <div class="action_grid">
            <div class="action" id="scan_qr">
                <div class="action_left">
                    <img class="action_image" src="images/Pfan6Qa.png">
                    <div>
                        <p class="action_title">Zeskanuj kod QR</p>
                        <p class="action_subtitle">Zaloguj się lub potwierdź swoje dane.</p>
                    </div>
                </div>
                <img class="arrow" src="images/2aN0vJE.png">
            </div>

            <div class="action" id="show_qr">
                <div class="action_left">
                    <img class="action_image" src="images/YJpEaiC.png">
                    <div>
                        <p class="action_title">Pokaż kod QR</p>
                        <p class="action_subtitle">Sprawdź dokument innej osoby.</p>
                    </div>
                </div>
                <img class="arrow" src="images/2aN0vJE.png">
            </div>
        </div>
    </div>

    <!-- === MODAL QR === -->
    <div id="qr_modal">
  <p class="qr_title">Pokaż kod QR</p>
  <p class="qr_subtitle">
    Poproś osobę, której przekazujesz dokument, aby zeskanowała lub przepisała ten kod w swojej aplikacji mObywatel.
  </p>

  <!-- Karta z QR i numerem -->
    <div class="qr_card">
        <div id="qrcode"></div>
        <div class="code-number" id="codeNumber">000000</div>

        <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
        </div>

        <p class="expire-text" id="expireText">Kod wygaśnie za: 3 min 00 sek</p>
    </div>

    <div class="flags">
        <img src="images/gzot1Pt.gif" alt="Flaga Polski">
        <img src="images/R5yccCK.gif" alt="Godło RP">
    </div>

    <button id="close_qr">← Wróć</button>
    </div>


    <!-- === DOLNY PASEK === -->
    <div class="bottom_bar">
        <a href="home.html" class="bottom_element_grid">
            <img src="images/2eKl73o.png" width="24" height="24" alt="Pulpit">
            <p class="bottom_element_text">Pulpit</p>
        </a>
        <a href="documents.html" class="bottom_element_grid">
            <img src="images/sltb5a0.png" width="24" height="24" alt="Dokumenty">
            <p class="bottom_element_text">Dokumenty</p>
        </a>
        <a href="services.html" class="bottom_element_grid">
            <img src="images/3Ft4ULN.png" width="24" height="24" alt="Usługi">
            <p class="bottom_element_text">Usługi</p>
        </a>
        <a href="qr.html" class="bottom_element_grid">
            <img src="images/P6F91tI.png" width="24" height="24" alt="Kod QR">
            <p class="bottom_element_text open">Kod QR</p>
        </a>
        <a href="more.html" class="bottom_element_grid">
            <img src="images/ECjKGrW.png" width="24" height="24" alt="Więcej">
            <p class="bottom_element_text">Więcej</p>
        </a>
    </div>

    <script>
        const showQR = document.getElementById('show_qr');
        const modal = document.getElementById('qr_modal');
        const closeQR = document.getElementById('close_qr');
        const qrDiv = document.getElementById("qrcode");
        const codeNumber = document.getElementById("codeNumber");
        const progressFill = document.getElementById("progressFill");
        const expireText = document.getElementById("expireText");

        let timeLeft = 180;
        let timer;

        showQR.addEventListener('click', () => {
            modal.style.display = 'flex';
            generateQR();
        });

        closeQR.addEventListener('click', () => {
            modal.style.display = 'none';
            clearInterval(timer);
        });

        function generateQR() {
            qrDiv.innerHTML = "";
            const randomCode = Math.floor(100000 + Math.random() * 900000);
            const qrData = "pObywatel-" + randomCode;

            new QRCode(qrDiv, {
                text: qrData,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            codeNumber.textContent = randomCode;
            timeLeft = 180;
            updateExpireText();
            updateProgressBar();
            clearInterval(timer);
            timer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            timeLeft--;
            updateExpireText();
            updateProgressBar();
            if (timeLeft <= 0) generateQR();
        }

        function updateExpireText() {
            const min = Math.floor(timeLeft / 60);
            const sec = timeLeft % 60;
            expireText.textContent = `Kod wygaśnie za: ${min} min ${sec < 10 ? "0" + sec : sec} sek`;
        }

        function updateProgressBar() {
            const progress = (timeLeft / 180) * 100;
            progressFill.style.width = progress + "%";
        }
    </script>
</body>
</html>
